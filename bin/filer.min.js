var PwnFiler=PwnFiler||function(a){a=a||{};this.multiple=a.multiple||false;if(a.uploadButton){var b=a.uploadButton;if(!(b instanceof Element)){b=document.querySelector(b)}this.initControl(b)}if(a.dropArea){var d=a.dropArea;if(!(d instanceof Element)){d=document.querySelector(d)}this.initDropArea(d,a.dropAreaActiveClass||"active")}if(a.selection){var c=a.selection;if(!(c instanceof Element)){c=document.querySelector(c)}this.initSelection(c)}else{throw"Missing file selection display"}};PwnFiler.prototype.initControl=function(a){var b=document.createElement("input");b.setAttribute("type","file");if(this.multiple){b.setAttribute("multiple","multiple")}var d=b.style;d.display="block";d.position="absolute";d.width=d.height="0";d.zIndex="-1000";a.parentNode.insertBefore(b,a);var c=this;a.addEventListener("click",function(e){return c.onUploadClick(e)},false);b.addEventListener("change",function(e){return c.onFileInputChange(e)},false);this.fileInput=b};PwnFiler.prototype.onUploadClick=function(a){this.fileInput.click();a.preventDefault();return false};PwnFiler.prototype.onFileInputChange=function(c){var d=c.target;if(d.files.length===0){this.onFileSelect(null)}else{var b=[];for(var a=0;a<d.files.length;a+=1){b[a]=d.files[a]}this.onFileSelect(b)}return true};PwnFiler.prototype.initDropArea=function(b,a){var c=this;b.addEventListener("dragenter",function(d){return c.onDropAreaDragEnter(d)},false);b.addEventListener("dragover",this.onDropAreaDragOver,false);b.addEventListener("dragleave",function(d){return c.onDropAreaDragLeave(d)},false);b.addEventListener("drop",function(d){return c.onDropAreaDrop(d)},false);this.dropArea=b;this.dropActiveClass=a;this.dropAreaEnterCount=0};PwnFiler.prototype.onDropAreaDragEnter=function(b){var a=b.dataTransfer;if(PwnFiler.dataTransferHasFiles(a)){a.dropEffect="copy"}else{return true}if(this.dropAreaEnterCount===0){this.activateDropArea()}this.dropAreaEnterCount+=1;b.stopPropagation();b.preventDefault();return false};PwnFiler.prototype.onDropAreaDragLeave=function(a){if(!PwnFiler.dataTransferHasFiles(a.dataTransfer)){return true}this.dropAreaEnterCount-=1;if(this.dropAreaEnterCount===0){this.deactivateDropArea()}};PwnFiler.prototype.dropAreaEnterCount=0;PwnFiler.prototype.onDropAreaDragOver=function(b){var a=b.dataTransfer;if(PwnFiler.dataTransferHasFiles(a)){a.dropEffect="copy"}else{return true}b.stopPropagation();b.preventDefault();return false};PwnFiler.prototype.onDropAreaDrop=function(d){this.dropAreaEnterCount=0;this.deactivateDropArea();var a=d.dataTransfer;if(a.files.length!==0){var c=[];for(var b=0;b<a.files.length;b+=1){c[b]=a.files.item(b)}this.onFileSelect(c);a.dropEffect="copy"}d.stopPropagation();d.preventDefault();return false};PwnFiler.prototype.activateDropArea=function(){var b=this.dropArea;var a=this.dropActiveClass;if(b.className.split(/\s+/).indexOf(a)===-1){b.className+=" "+a}};PwnFiler.prototype.deactivateDropArea=function(){var b=this.dropArea;var a=this.dropActiveClass;b.className=b.className.split(/\s+/).filter(function(c){return c!==a}).join(" ")};PwnFiler.dataTransferHasFiles=function(a){if(a.types.contains){return a.types.contains("Files")}else{if(a.types.indexOf){return a.types.indexOf("Files")!==-1}else{if(a.files){return a.files.length>0}}}return false};PwnFiler.prototype.initSelection=function(a){this.selection=[];this.selectionDom=a};PwnFiler.prototype.onFileSelect=function(b){if(this.multiple){for(var a=0;a<b.length;a+=1){this.addFile(b[a])}}else{if(this.selection.length>0){this.removeFile(this.selection[0])}this.addFile(b[0])}if(!this.multiple){return}};PwnFiler.prototype.selection=null;PwnFiler.prototype.selectionDom=null;PwnFiler.prototype.addFile=function(b){var a={domFile:b};this.selection.push(a);this.selectionDom.appendChild(this.buildFileSelectionDom(a))};PwnFiler.prototype.removeFile=function(b){var a=0;for(;a<this.selection.length;a+=1){if(this.selection[a]===b){break}}this.selection.splice(a,1);this.selectionDom.removeChild(b.selectionDom)};PwnFiler.prototype.buildFileSelectionDom=function(c){var g=document.createElement("span");g.className="name";g.appendChild(document.createTextNode(c.domFile.name));var e=document.createElement("span");e.className="size";var h="";var d=c.domFile.size;if(d<1024){h=""+d+" bytes"}else{if(d<1024*1024){h=""+(d/1024).toFixed(2)+" kb"}else{if(d<1024*1024*1024){h=""+(d/(1024*1024)).toFixed(2)+" mb"}else{h=""+(d/(1024*1024*1024)).toFixed(2)+" gb"}}}e.appendChild(document.createTextNode(h));var b=document.createElement("progress");b.setAttribute("max",d);b.setAttribute("value",0);c.progressDom=b;var f=document.createElement("button");f.appendChild(document.createTextNode("Remove"));f.addEventListener("click",this.removeClickListener(c),false);var a=document.createElement("li");a.appendChild(g);a.appendChild(e);a.appendChild(b);a.appendChild(f);c.selectionDom=a;return a};PwnFiler.prototype.removeClickListener=function(a){var b=this;return function(c){b.removeFile(a);c.preventDefault();return false}};PwnFiler.prototype.pumpFiles=function(e){if(e){var c=e[0];this.currentFile=c[0];$("#upload-file-name").text(c.name+" "+c.size+" "+c.type);var b=c;var f=c.size*0.9;var d=128*1024;if(c.slice){b=c.slice(f,d,c.type)}else{if(c.mozSlice){b=c.mozSlice(f,f+d,c.type)}else{if(c.webkitSlice){b=c.webkitSlice(f,f+d,c.type)}else{$("#upload-file-name").text("no File.slice support; reading whole file")}}}var a=new FileReader();a.onloadend=function(g){if(g.target.readyState!==FileReader.DONE){return}var h=g.target.result;$("#status-text").text("read "+h.length+" bytes")};a.readAsBinaryString(b)}else{$("#upload-file-name").text("none")}};PwnFiler.prototype.currentFile=null;